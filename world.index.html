<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å‡ºåœ‹æ”æ¬¸é€š - ä¸€æ¬¾ç‚ºæ‚¨æ‰“é€ çš„å•å·´App</title>
  <!-- è¨­å®š iPhone/Android æ¡Œé¢åœ–ç¤º -->
<link rel="apple-touch-icon" href="https://github.com/doryii/travel-speaknoworries/blob/main/Gemini_Generated_Image_ealh3jealh3jealh.png?raw=true">
<link rel="icon" type="image/png" href="https://github.com/doryii/travel-speaknoworries/blob/main/Gemini_Generated_Image_ealh3jealh3jealh.png?raw=true">  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <!-- è¼‰å…¥ Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- è¼‰å…¥ React -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
  </script>

  <style>
    body { 
      -webkit-tap-highlight-color: transparent; 
      transition: background-color 0.5s; 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }
    .rotate-y-180 { transform: rotateY(180deg); }
    .preserve-3d { transform-style: preserve-3d; }
    .backface-hidden { backface-visibility: hidden; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* --- 3D åœ°çƒèˆ‡é£›æ©Ÿå‹•ç•« --- */
    .earth-container {
      width: 240px;
      height: 240px;
      position: relative;
      border-radius: 50%;
      background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/Earthmap1000x500compac.jpg/640px-Earthmap1000x500compac.jpg');
      background-size: 600px 100%;
      box-shadow: inset 16px 0 40px 6px rgba(0,0,0,0.2), inset -4px -4px 10px rgba(255,255,255,0.4), 0 20px 40px rgba(0,0,0,0.1);
      animation: rotateEarth 30s linear infinite;
      z-index: 10;
    }
    
    .orbit-container {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 340px;
      height: 340px;
      transform: translate(-50%, -50%);
      border-radius: 50%;
      animation: orbitRotate 12s linear infinite;
      pointer-events: none;
      z-index: 20;
    }

    .airplane-icon {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translate(-50%, -50%) rotate(90deg);
      font-size: 32px;
      filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.2));
    }
    
    .earth-wrapper {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      animation: floatEarth 6s ease-in-out infinite;
    }

    @keyframes rotateEarth {
      0% { background-position: 0 0; }
      100% { background-position: -600px 0; }
    }

    @keyframes orbitRotate {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    @keyframes floatEarth {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }
    
    /* é€šç”¨æ¼‚æµ®å‹•ç•« (èƒŒæ™¯æ‰è½ç‰©) */
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React, { useState, useEffect } from 'react';
    import { createRoot } from 'react-dom/client';
    import { 
      Star, MapPin, AlertTriangle, BookOpen, 
      Utensils, ShoppingBag, Bed, Train, Volume2, 
      Maximize2, X, Calculator, Languages, ChevronLeft, Sparkles, Globe, Repeat, Plane,
      Wine, Home
    } from 'lucide-react';

    // --- è¥¿ç­ç‰™ç‰¹è‰²åœ–æ¡ˆ SVG ---
    const Flamenco = ({size, color}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M4.5 10C4.5 10 6 8 8 8C10 8 11 10 11 10C11 10 12 8 14 8C16 8 17.5 10 17.5 10"/>
        <path d="M11 10V14"/> <path d="M14 14L11 10L8 14"/> <path d="M8 14L5 20H17L14 14"/> <path d="M11 4C11 5.10457 10.1046 6 9 6C7.89543 6 7 5.10457 7 4C7 2.89543 7.89543 2 9 2C10.1046 2 11 2.89543 11 4Z"/>
        <path d="M18.5 6C19.8807 6 21 4.88071 21 3.5C21 2.11929 19.8807 1 18.5 1C17.1193 1 16 2.11929 16 3.5C16 4.88071 17.1193 6 18.5 6Z"/> <path d="M21 10L18.5 6L16 10"/>
      </svg>
    );
    const Bull = ({size, color}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M7 16L4 20"/> <path d="M17 16L20 20"/> <path d="M12 18V22"/> <path d="M4 13H20"/>
        <path d="M12 18C14.2091 18 16 16.2091 16 14C16 11.7909 14.2091 10 12 10C9.79086 10 8 11.7909 8 14C8 16.2091 9.79086 18 12 18Z"/>
        <path d="M6 9C6 9 6.5 5 12 5C17.5 5 18 9 18 9"/> <path d="M6 9L3 6"/> <path d="M18 9L21 6"/> <path d="M9 12L10 13"/> <path d="M15 12L14 13"/>
      </svg>
    );

    // ==========================================
    // 1. è¨­å®šèˆ‡ä¸»é¡Œ
    // ==========================================
    const THEMES = {
      jp: {
        name: "æ—¥èªæ”æ¬¸é€š", sub: "åœ¨æ—¥å°å¹«æ‰‹", code: "JP", langCode: "ja-JP",
        bgColor: "#FFF8E7", bgStyle: {},
        primaryColor: "text-yellow-500", accentColor: "bg-yellow-400",
        buttonText: "text-white", 
        tabLabel: "äº”åéŸ³", iconColor: "text-yellow-500", sosColor: "bg-red-500"
      },
      kr: {
        name: "éŸ“èªæ”æ¬¸é€š", sub: "åœ¨éŸ“å°å¹«æ‰‹", code: "KR", langCode: "ko-KR",
        bgColor: "#B2F7EF", bgStyle: { backgroundImage: 'linear-gradient(90deg, transparent 50%, rgba(255, 255, 255, 0.6) 50%)', backgroundSize: '40px 100%' },
        primaryColor: "text-[#5D4037]", accentColor: "bg-[#5D4037]",
        buttonText: "text-[#B2F7EF]", 
        dropEmoji: "ğŸ«", tabLabel: "å››åéŸ³", iconColor: "text-[#5D4037]", sosColor: "bg-red-500"
      },
      es: {
        name: "è¥¿èªæ”æ¬¸é€š", sub: "åœ¨è¥¿å°å¹«æ‰‹", code: "ES", langCode: "es-ES",
        bgColor: "#FAF3E0", 
        bgStyle: { 
          backgroundImage: `linear-gradient(45deg, #EAD8C8 25%, transparent 25%, transparent 75%, #EAD8C8 75%, #EAD8C8), linear-gradient(45deg, #EAD8C8 25%, transparent 25%, transparent 75%, #EAD8C8 75%, #EAD8C8)`,
          backgroundSize: '40px 40px',
          backgroundPosition: '0 0, 20px 20px'
        },
        primaryColor: "text-[#2C3E50]", accentColor: "bg-[#AA151B]",
        buttonText: "text-[#F1BF00]", 
        tabLabel: "å­—æ¯", iconColor: "text-[#AA151B]", sosColor: "bg-red-600"
      },
      fr: {
        name: "æ³•èªæ”æ¬¸é€š", sub: "åœ¨æ³•å°å¹«æ‰‹", code: "FR", langCode: "fr-FR",
        bgColor: "#F5F5F5", bgStyle: { backgroundImage: 'linear-gradient(0deg, transparent 50%, rgba(0, 35, 149, 0.08) 50%)', backgroundSize: '100% 30px' },
        primaryColor: "text-[#002395]", accentColor: "bg-[#002395]",
        buttonText: "text-white", 
        tabLabel: "å­—æ¯", iconColor: "text-[#ED2939]", sosColor: "bg-red-600"
      }
    };

    // ==========================================
    // 2. è³‡æ–™åº« (Database)
    // ==========================================
    const DB = {
      jp: {
        alphabet: [
          { row: 'a', items: [{h:'ã‚',k:'ã‚¢',r:'a'},{h:'ã„',k:'ã‚¤',r:'i'},{h:'ã†',k:'ã‚¦',r:'u'},{h:'ãˆ',k:'ã‚¨',r:'e'},{h:'ãŠ',k:'ã‚ª',r:'o'}] },
          { row: 'k', items: [{h:'ã‹',k:'ã‚«',r:'ka'},{h:'ã',k:'ã‚­',r:'ki'},{h:'ã',k:'ã‚¯',r:'ku'},{h:'ã‘',k:'ã‚±',r:'ke'},{h:'ã“',k:'ã‚³',r:'ko'}] },
          { row: 's', items: [{h:'ã•',k:'ã‚µ',r:'sa'},{h:'ã—',k:'ã‚·',r:'shi'},{h:'ã™',k:'ã‚¹',r:'su'},{h:'ã›',k:'ã‚»',r:'se'},{h:'ã',k:'ã‚½',r:'so'}] },
          { row: 't', items: [{h:'ãŸ',k:'ã‚¿',r:'ta'},{h:'ã¡',k:'ãƒ',r:'chi'},{h:'ã¤',k:'ãƒ„',r:'tsu'},{h:'ã¦',k:'ãƒ†',r:'te'},{h:'ã¨',k:'ãƒˆ',r:'to'}] },
          { row: 'n', items: [{h:'ãª',k:'ãƒŠ',r:'na'},{h:'ã«',k:'ãƒ‹',r:'ni'},{h:'ã¬',k:'ãƒŒ',r:'nu'},{h:'ã­',k:'ãƒ',r:'ne'},{h:'ã®',k:'ãƒ',r:'no'}] },
          { row: 'h', items: [{h:'ã¯',k:'ãƒ',r:'ha'},{h:'ã²',k:'ãƒ’',r:'hi'},{h:'ãµ',k:'ãƒ•',r:'fu'},{h:'ã¸',k:'ãƒ˜',r:'he'},{h:'ã»',k:'ãƒ›',r:'ho'}] },
          { row: 'm', items: [{h:'ã¾',k:'ãƒ',r:'ma'},{h:'ã¿',k:'ãƒŸ',r:'mi'},{h:'ã‚€',k:'ãƒ ',r:'mu'},{h:'ã‚',k:'ãƒ¡',r:'me'},{h:'ã‚‚',k:'ãƒ¢',r:'mo'}] },
          { row: 'y', items: [{h:'ã‚„',k:'ãƒ¤',r:'ya'},{h:' ',k:' ',r:''},{h:'ã‚†',k:'ãƒ¦',r:'yu'},{h:' ',k:' ',r:''},{h:'ã‚ˆ',k:'ãƒ¨',r:'yo'}] },
          { row: 'r', items: [{h:'ã‚‰',k:'ãƒ©',r:'ra'},{h:'ã‚Š',k:'ãƒª',r:'ri'},{h:'ã‚‹',k:'ãƒ«',r:'ru'},{h:'ã‚Œ',k:'ãƒ¬',r:'re'},{h:'ã‚',k:'ãƒ­',r:'ro'}] },
          { row: 'w', items: [{h:'ã‚',k:'ãƒ¯',r:'wa'},{h:' ',k:' ',r:''},{h:' ',k:' ',r:''},{h:' ',k:' ',r:''},{h:'ã‚’',k:'ãƒ²',r:'wo'}] },
          { row: 'n', items: [{h:'ã‚“',k:'ãƒ³',r:'n'},{h:' ',k:' ',r:''},{h:' ',k:' ',r:''},{h:' ',k:' ',r:''},{h:' ',k:' ',r:''}] },
        ],
        foundation: [
          { ch: "ä½ å¥½", en: "Hello", jp: "ã“ã‚“ã«ã¡ã¯", ro: "Konnichiwa", tip: "ç©ºä½ ä¸ƒå“‡" },
          { ch: "è¬è¬", en: "Thank you", jp: "ã‚ã‚ŠãŒã¨ã†", ro: "Arigatou", tip: "é˜¿é‡Œå˜å¤š" },
          { ch: "è«‹/æ‹œè¨—äº†", en: "Please", jp: "ãŠé¡˜ã„ã—ã¾ã™", ro: "Onegaishimasu", tip: "æ­å…§è©²å¸éº»ç³¬" },
          { ch: "æŠ±æ­‰", en: "Sorry", jp: "ã”ã‚ã‚“ãªã•ã„", ro: "Gomennasai", tip: "ç‹—å¦¹é‚£è³½" },
          { ch: "æ˜¯ (å¥½)", en: "Yes", jp: "ã¯ã„", ro: "Hai", tip: "å—¨ï¼" },
          { ch: "ä¸æ˜¯", en: "No", jp: "ã„ã„ãˆ", ro: "Iie", tip: "ä¸€è€¶" },
          { ch: "æˆ‘æ˜¯å°ç£äºº", en: "I am Taiwanese", jp: "å°æ¹¾äººã§ã™", audioJp: "ãŸã„ã‚ã‚“ã˜ã‚“ã§ã™", ro: "Taiwanjin desu", tip: "å°ç£é‡‘ + çˆ¹è˜‡" },
          { ch: "å€Ÿé", en: "Excuse me", jp: "ã™ã¿ã¾ã›ã‚“", ro: "Sumimasen", tip: "è˜‡å’ªåª½Sen" },
          { ch: "é€™å€‹", en: "This one", jp: "ã“ã‚Œ", ro: "Kore", tip: "å£è•¾" },
          { ch: "å†è¦‹", en: "Goodbye", jp: "ã•ã‚ˆã†ãªã‚‰", ro: "Sayounara", tip: "æ’’å„ªå¨œæ‹‰" },
        ],
        numbers: [
          { ch: "1", en: "One", jp: "ã„ã¡", ro: "Ichi" }, { ch: "2", en: "Two", jp: "ã«", ro: "Ni" }, { ch: "3", en: "Three", jp: "ã•ã‚“", ro: "San" },
          { ch: "10", en: "Ten", jp: "ã˜ã‚…ã†", ro: "Juu" }, { ch: "100", en: "100", jp: "ã²ã‚ƒã", ro: "Hyaku" }, { ch: "1000", en: "1000", jp: "ã›ã‚“", ro: "Sen" },
          { ch: "10000", en: "10000", jp: "ã„ã¡ã¾ã‚“", ro: "Ichiman" }
        ],
        transport: [
          { ch: "ICå¡åˆ·ä¸é", en: "IC Card Error", jp: "ICã‚«ãƒ¼ãƒ‰ãŒä½¿ãˆã¾ã›ã‚“", ro: "IC ka-do ga tsukaemasen" },
          { ch: "é€™ç­è»Šå»...å—ï¼Ÿ", en: "Does it go to...?", jp: "ã“ã®é›»è»Šã¯...ã«è¡Œãã¾ã™ã‹", ro: "Kono densha wa ... ni ikimasu ka" }
        ],
        dining: [
          { ch: "æœ‰ä¸­æ–‡èœå–®å—ï¼Ÿ", en: "Chinese menu?", jp: "ä¸­å›½èªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã™ã‹", ro: "Chuugokugo no menyuu wa arimasu ka" },
          { ch: "æˆ‘è¦é€™å€‹", en: "I'll have this", jp: "ã“ã‚Œã‚’ãã ã•ã„", ro: "Kore o kudasai" }
        ],
        shopping: [
          { ch: "å¯ä»¥å…ç¨…å—ï¼Ÿ", en: "Tax-free?", jp: "å…ç¨ã§ãã¾ã™ã‹", ro: "Menzei dekimasu ka" },
          { ch: "å¤šå°‘éŒ¢ï¼Ÿ", en: "How much?", jp: "ã„ãã‚‰ã§ã™ã‹", ro: "Ikura desu ka" }
        ],
        hotel: [
          { ch: "æˆ‘è¦è¾¦ç†å…¥ä½", en: "Check-in please", jp: "ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚’ãŠé¡˜ã„ã—ã¾ã™", ro: "Chekkuin o onegaishimasu" },
          { ch: "å¯ä»¥å¯„æ”¾è¡Œæå—ï¼Ÿ", en: "Luggage?", jp: "è·ç‰©ã‚’é ã‹ã£ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹", ro: "Nimotsu o azukatte moraemasu ka" }
        ],
        sos: [
          { text: "æ•‘å‘½ï¼", jp: "åŠ©ã‘ã¦ï¼", ro: "Tasukete!" },
          { text: "æˆ‘ä¸èˆ’æœ", jp: "å…·åˆãŒæ‚ªã„ã§ã™", ro: "Guai ga warui desu" },
          { text: "è­·ç…§ä¸è¦‹äº†", jp: "ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã‚’ãªãã—ã¾ã—ãŸ", ro: "Pasupooto o nakushimashita" }
        ]
      },
      kr: {
        alphabet: [
          { row: 'c1', title:'åŸºæœ¬å­éŸ³', items: [{k:'ã„±',r:'g/k'},{k:'ã„´',r:'n'},{k:'ã„·',r:'d/t'},{k:'ã„¹',r:'r/l'},{k:'ã…',r:'m'}] },
          { row: 'c2', title:'', items: [{k:'ã…‚',r:'b/p'},{k:'ã……',r:'s'},{k:'ã…‡',r:'ng'},{k:'ã…ˆ',r:'j'},{k:'ã…Š',r:'ch'}] },
          { row: 'c3', title:'', items: [{k:'ã…‹',r:'k'},{k:'ã…Œ',r:'t'},{k:'ã…',r:'p'},{k:'ã…',r:'h'},{k:' ',r:''}] },
          { row: 'cc', title:'é›™å­éŸ³', items: [{k:'ã„²',r:'kk'},{k:'ã„¸',r:'tt'},{k:'ã…ƒ',r:'pp'},{k:'ã…†',r:'ss'},{k:'ã…‰',r:'jj'}] },
          { row: 'v1', title:'åŸºæœ¬æ¯éŸ³', items: [{k:'ã…',r:'a'},{k:'ã…‘',r:'ya'},{k:'ã…“',r:'eo'},{k:'ã…•',r:'yeo'},{k:'ã…—',r:'o'}] },
          { row: 'v2', title:'', items: [{k:'ã…›',r:'yo'},{k:'ã…œ',r:'u'},{k:'ã… ',r:'yu'},{k:'ã…¡',r:'eu'},{k:'ã…£',r:'i'}] },
          { row: 'v3', title:'è¤‡åˆæ¯éŸ³', items: [{k:'ã…',r:'ae'},{k:'ã…’',r:'yae'},{k:'ã…”',r:'e'},{k:'ã…–',r:'ye'},{k:'ã…˜',r:'wa'}] },
          { row: 'v4', title:'', items: [{k:'ã…™',r:'wae'},{k:'ã…š',r:'oe'},{k:'ã…',r:'wo'},{k:'ã…',r:'we'},{k:'ã…Ÿ',r:'wi'}] },
          { row: 'v5', title:'', items: [{k:'ã…¢',r:'ui'},{k:'',r:''},{k:'',r:''},{k:'',r:''},{k:'',r:''}] },
        ],
        foundation: [
          { ch: "ä½ å¥½", en: "Hello", jp: "ì•ˆë…•í•˜ì„¸ìš”", ro: "Annyeonghaseyo", tip: "å®‰å¦å“ˆèª°å”·" },
          { ch: "è¬è¬", en: "Thank you", jp: "ê°ì‚¬í•©ë‹ˆë‹¤", ro: "Kamsahamnida", tip: "åº·æ’’å“ˆå’ªæ­" },
          { ch: "è«‹/æ‹œè¨—äº†", en: "Please", jp: "ë¶€íƒí•©ë‹ˆë‹¤", ro: "Butakamnida", tip: "æ™®å¡”å¡å’ªæ­" },
          { ch: "æŠ±æ­‰", en: "Sorry", jp: "ì£„ì†¡í•©ë‹ˆë‹¤", ro: "Joesonghamnida", tip: "å´”é€å“ˆå’ªæ­" },
          { ch: "æ˜¯ (å¥½)", en: "Yes", jp: "ë„¤", ro: "Ne", tip: "å…§" },
          { ch: "ä¸æ˜¯", en: "No", jp: "ì•„ë‹ˆìš”", ro: "Aniyo", tip: "é˜¿å°¼å”·" },
          { ch: "æˆ‘æ˜¯å°ç£äºº", en: "I am Taiwanese", jp: "ì €ëŠ” ëŒ€ë§Œ ì‚¬ëŒì…ë‹ˆë‹¤", ro: "Jeoneun Daeman saram imnida", tip: "ç§‹å«© å°ç£ æ²™æœ— æ˜“å’ªæ­" },
          { ch: "å€Ÿé", en: "Excuse me", jp: "ì ì‹œë§Œìš”", ro: "Jamsimanyo", tip: "æš«æ´—æ…¢å”·" },
          { ch: "é€™å€‹", en: "This one", jp: "ì´ê±°", ro: "Igeo", tip: "ä»¥å‹¾" },
          { ch: "å†è¦‹", en: "Goodbye", jp: "ì•ˆë…•íˆ ê³„ì„¸ìš”", ro: "Annyeonghi gyeseyo", tip: "å®‰å¦hee K-Say-Yo (å°ç•™ä¸‹çš„äººèªª)" },
        ],
        numbers: [
          { ch: "1", en: "One", jp: "ì¼", ro: "Il" }, { ch: "2", en: "Two", jp: "ì´", ro: "I" }, { ch: "3", en: "Three", jp: "ì‚¼", ro: "Sam" },
          { ch: "10", en: "Ten", jp: "ì‹­", ro: "Sip" }, { ch: "100", en: "100", jp: "ë°±", ro: "Baek" }, { ch: "1000", en: "1000", jp: "ì²œ", ro: "Cheon" },
          { ch: "10000", en: "10000", jp: "ë§Œ", ro: "Man" }
        ],
        transport: [
          { ch: "äº¤é€šå¡åˆ·ä¸é", en: "Card Error", jp: "ì¹´ë“œê°€ ì•ˆ ë¼ìš”", ro: "Kadeuga an dwaeyo" },
          { ch: "æˆ‘è¦å»é€™è£¡", en: "Go here", jp: "ì—¬ê¸°ë¡œ ê°€ê³  ì‹¶ì–´ìš”", ro: "Yeogiro gago sipeoyo" }
        ],
        dining: [
          { ch: "æœ‰ä¸­æ–‡èœå–®å—ï¼Ÿ", en: "Chinese menu?", jp: "ì¤‘êµ­ì–´ ë©”ë‰´ ìˆì–´ìš”?", ro: "Junggugeo menyu isseoyo?" },
          { ch: "æ¨è–¦ä»€éº¼ï¼Ÿ", en: "Recommend?", jp: "ì¶”ì²œí•´ ì£¼ì„¸ìš”", ro: "Chucheonhae juseyo" }
        ],
        shopping: [
          { ch: "å¯ä»¥å…ç¨…å—ï¼Ÿ", en: "Tax-free?", jp: "ë©´ì„¸ ë¼ìš”?", ro: "Myeonse dwaeyo?" },
          { ch: "å¤šå°‘éŒ¢ï¼Ÿ", en: "How much?", jp: "ì–¼ë§ˆì˜ˆìš”?", ro: "Eolmayeyo?" }
        ],
        hotel: [
          { ch: "æˆ‘è¦è¾¦ç†å…¥ä½", en: "Check-in", jp: "ì²´í¬ì¸ ë¶€íƒí•©ë‹ˆë‹¤", ro: "Chekeuin butakamnida" },
          { ch: "Wi-Fi å¯†ç¢¼", en: "Wi-Fi", jp: "ì™€ì´íŒŒì´ ë¹„ë°€ë²ˆí˜¸ ë­ì˜ˆìš”?", ro: "Waipai bimilbeonho mwoyeyo?" }
        ],
        sos: [
          { text: "æ•‘å‘½ï¼", jp: "ë„ì™€ì£¼ì„¸ìš”!", ro: "Dowajuseyo!" },
          { text: "æˆ‘ä¸èˆ’æœ", jp: "ëª¸ì´ ì•ˆ ì¢‹ì•„ìš”", ro: "Momi an joayo" },
          { text: "è­·ç…§ä¸è¦‹äº†", jp: "ì—¬ê¶Œì„ ìƒì–´ë²„ë ¸ì–´ìš”", ro: "Yeogwoneul ireobeoryeosseoyo" }
        ]
      },
      es: {
        alphabet: [
          { row: '1', items: [{k:'A',r:'é˜¿',a:'a'},{k:'B',r:'è²',a:'be'},{k:'C',r:'å¡',a:'ce'},{k:'D',r:'å¾—',a:'de'},{k:'E',r:'æ¬¸',a:'e'}] },
          { row: '2', items: [{k:'F',r:'æ¬¸F',a:'efe'},{k:'G',r:'é»‘',a:'ge'},{k:'H',r:'é˜¿åˆ‡',a:'hache'},{k:'I',r:'ä¼Š',a:'i'},{k:'J',r:'å¼å¡”',a:'jota'}] },
          { row: '3', items: [{k:'K',r:'å¡',a:'ka'},{k:'L',r:'æ¬¸å‹’',a:'ele'},{k:'M',r:'æ¬¸M',a:'eme'},{k:'N',r:'æ¬¸N',a:'ene'},{k:'Ã‘',r:'æ¬¸æ',a:'eÃ±e'}] },
          { row: '4', items: [{k:'O',r:'å–”',a:'o'},{k:'P',r:'ä½©',a:'pe'},{k:'Q',r:'å§‘',a:'cu'},{k:'R',r:'è‰¾é›·',a:'erre'},{k:'S',r:'æ¬¸S',a:'ese'}] },
          { row: '5', items: [{k:'T',r:'å¾—',a:'te'},{k:'U',r:'å—š',a:'u'},{k:'V',r:'çƒV',a:'uve'},{k:'W',r:'é”ä¸æºœ',a:'uve doble'},{k:'X',r:'æ¬¸kis',a:'equis'}] },
          { row: '6', items: [{k:'Y',r:'è€¶',a:'ye'},{k:'Z',r:'Cå¡”',a:'zeta'},{k:'CH',r:'åˆ‡',a:'che'},{k:'LL',r:'æ¬¸è€¶',a:'elle'},{k:'RR',r:'å¤§å½ˆèˆŒ',a:'erre'}] }
        ],
        foundation: [
          { ch: "ä½ å¥½", en: "Hello", jp: "Hola", ro: "Hola", tip: "æ­æ‹‰" },
          { ch: "è¬è¬", en: "Thank you", jp: "Gracias", ro: "Gracias", tip: "è‘›æ‹‰å–œäºæ–¯" },
          { ch: "è«‹/æ‹œè¨—äº†", en: "Please", jp: "Por favor", ro: "Por favor", tip: "æ³¢ ç™¼æ²ƒ" },
          { ch: "æŠ±æ­‰", en: "Sorry", jp: "Lo siento", ro: "Lo siento", tip: "å›‰ ä»™å·" },
          { ch: "æ˜¯ (å¥½)", en: "Yes", jp: "SÃ­", ro: "SÃ­", tip: "å¸" },
          { ch: "ä¸æ˜¯", en: "No", jp: "No", ro: "No", tip: "No" },
          { ch: "æˆ‘æ˜¯å°ç£äºº", en: "I am Taiwanese", jp: "Soy de TaiwÃ¡n", ro: "Soy de TaiwÃ¡n", tip: "æœä»¥å¾— å°ç£" },
          { ch: "å€Ÿé", en: "Excuse me", jp: "Con permiso", ro: "Con permiso", tip: "ç©º ä½©ç±³æœ" },
          { ch: "é€™å€‹", en: "This one", jp: "Esto", ro: "Esto", tip: "æ¬¸æ­»å·" },
          { ch: "å†è¦‹", en: "Goodbye", jp: "AdiÃ³s", ro: "AdiÃ³s", tip: "é˜¿åº•å–”æ–¯" },
        ],
        numbers: [
          { ch: "1", en: "One", jp: "Uno", ro: "Uno" }, { ch: "2", en: "Two", jp: "Dos", ro: "Dos" }, { ch: "3", en: "Three", jp: "Tres", ro: "Tres" },
          { ch: "10", en: "Ten", jp: "Diez", ro: "Diez" }, { ch: "100", en: "100", jp: "Cien", ro: "Cien" }, { ch: "1000", en: "1000", jp: "Mil", ro: "Mil" }
        ],
        transport: [
          { ch: "ç¥¨ç„¡æ•ˆ/åˆ·ä¸é", en: "Ticket Error", jp: "El billete no funciona", ro: "El billete no funciona" },
          { ch: "æˆ‘è¦å»é€™è£¡", en: "Go here", jp: "Quiero ir aquÃ­", ro: "Quiero ir aquÃ­" }
        ],
        dining: [
          { ch: "æœ‰è‹±æ–‡èœå–®å—ï¼Ÿ", en: "English menu?", jp: "Â¿Tiene un menÃº en inglÃ©s?", ro: "Â¿Tiene un menÃº en inglÃ©s?" },
          { ch: "çµå¸³", en: "Bill", jp: "La cuenta, por favor", ro: "La cuenta, por favor" }
        ],
        shopping: [
          { ch: "å¯ä»¥å…ç¨…å—ï¼Ÿ", en: "Tax-free?", jp: "Â¿Es Tax-free?", ro: "Â¿Es Tax-free?" },
          { ch: "å¤šå°‘éŒ¢ï¼Ÿ", en: "How much?", jp: "Â¿CuÃ¡nto cuesta?", ro: "Â¿CuÃ¡nto cuesta?" }
        ],
        hotel: [
          { ch: "æˆ‘è¦è¾¦ç†å…¥ä½", en: "Check-in", jp: "El check-in, por favor", ro: "El check-in, por favor" },
          { ch: "å¯ä»¥å¯„æ”¾è¡Œæå—ï¼Ÿ", en: "Luggage?", jp: "Â¿Puedo dejar mis maletas?", ro: "Â¿Puedo dejar mis maletas?" }
        ],
        sos: [
          { text: "æ•‘å‘½ï¼", jp: "Â¡Socorro!", ro: "Socorro" },
          { text: "æˆ‘ä¸èˆ’æœ", jp: "No me siento bien", ro: "No me siento bien" },
          { text: "è­·ç…§ä¸è¦‹äº†", jp: "He perdido mi pasaporte", ro: "He perdido mi pasaporte" }
        ]
      },
      fr: {
        alphabet: [
          { row: '1', items: [{k:'A',r:'é˜¿',a:'a'},{k:'B',r:'è²',a:'bÃ©'},{k:'C',r:'å¡',a:'cÃ©'},{k:'D',r:'å¾—',a:'dÃ©'},{k:'E',r:'å„',a:'e'}] },
          { row: '2', items: [{k:'F',r:'æ¬¸F',a:'effe'},{k:'G',r:'J(æ—¥)',a:'gÃ©'},{k:'H',r:'é˜¿é ˆ',a:'hache'},{k:'I',r:'ä¼Š',a:'i'},{k:'J',r:'Ji(å‰)',a:'ji'}] },
          { row: '3', items: [{k:'K',r:'å¡',a:'ka'},{k:'L',r:'æ¬¸å‹’',a:'elle'},{k:'M',r:'æ¬¸M',a:'emme'},{k:'N',r:'æ¬¸N',a:'enne'},{k:'O',r:'æ­',a:'o'}] },
          { row: '4', items: [{k:'P',r:'ä½©',a:'pÃ©'},{k:'Q',r:'å“­',a:'ku'},{k:'R',r:'å°èˆŒ',a:'erre'},{k:'S',r:'æ¬¸S',a:'esse'},{k:'T',r:'å¾—',a:'tÃ©'}] },
          { row: '5', items: [{k:'U',r:'æ·¤',a:'u'},{k:'V',r:'å¨',a:'vÃ©'},{k:'W',r:'éƒ½V',a:'double vÃ©'},{k:'X',r:'å…‹æ–¯',a:'iks'},{k:'Y',r:'ä¼Šè‘›',a:'i grec'}] },
          { row: '6', items: [{k:'Z',r:'è³½å¾·',a:'zÃ¨de'},{k:'Ã‡',r:'SéŸ³',a:'cÃ©dille'},{k:'Ã‰',r:'æ¬¸(é–‰)',a:'Ã©'},{k:'Ãˆ',r:'æ¬¸(é–‹)',a:'Ã¨'},{k:'Å’',r:'å„',a:'e dans l\'o'}] },
          { row: '7', items: [{k:'AN',r:'æ˜‚',a:'an'},{k:'ON',r:'ç¿',a:'on'},{k:'IN',r:'å®‰',a:'in'},{k:'OI',r:'å“‡',a:'oi'},{k:'OU',r:'å—š',a:'ou'}] }
        ],
        foundation: [
          { ch: "ä½ å¥½", en: "Hello", jp: "Bonjour", ro: "Bonjour", tip: "å´©æœ±" },
          { ch: "è¬è¬", en: "Thank you", jp: "Merci", ro: "Merci", tip: "æ¢…è¥¿" },
          { ch: "è«‹/æ‹œè¨—äº†", en: "Please", jp: "S'il vous plaÃ®t", ro: "S'il vous plaÃ®t", tip: "å¸Œ-æ­¦-æ™®é›·" },
          { ch: "æŠ±æ­‰", en: "Sorry", jp: "DÃ©solÃ©", ro: "DÃ©solÃ©", tip: "çˆ¹æœé›·" },
          { ch: "æ˜¯ (å¥½)", en: "Yes", jp: "Oui", ro: "Oui", tip: "We" },
          { ch: "ä¸æ˜¯", en: "No", jp: "Non", ro: "Non", tip: "å¼„" },
          { ch: "æˆ‘æ˜¯å°ç£äºº", en: "I am Taiwanese", jp: "Je suis TaÃ¯wanais", audioJp: "Je suis TaÃ¯wanais", ro: "Je suis TaÃ¯wanais", tip: "æƒ¹-ç©—-å°ç£å…§" },
          { ch: "å€Ÿé", en: "Excuse me", jp: "Pardon", ro: "Pardon", tip: "å¸•æ±" },
          { ch: "é€™å€‹", en: "This one", jp: "Ã‡a", ro: "Ã‡a", tip: "è–©" },
          { ch: "å†è¦‹", en: "Goodbye", jp: "Au revoir", ro: "Au revoir", tip: "æ­-éœ-ç“¦" },
        ],
        numbers: [
          { ch: "1", en: "One", jp: "Un", ro: "Un" }, { ch: "2", en: "Two", jp: "Deux", ro: "Deux" }, { ch: "3", en: "Three", jp: "Trois", ro: "Trois" },
          { ch: "10", en: "Ten", jp: "Dix", ro: "Dix" }, { ch: "100", en: "100", jp: "Cent", ro: "Cent" }, { ch: "1000", en: "1000", jp: "Mille", ro: "Mille" }
        ],
        transport: [
          { ch: "ç¥¨ç„¡æ•ˆ/åˆ·ä¸é", en: "Ticket Error", jp: "Le billet ne passe pas", ro: "Le billet ne passe pas" },
          { ch: "æˆ‘è¦å»é€™è£¡", en: "Go here", jp: "Je veux aller ici", ro: "Je veux aller ici" }
        ],
        dining: [
          { ch: "æœ‰è‹±æ–‡èœå–®å—ï¼Ÿ", en: "English menu?", jp: "Avez-vous un menu en anglais?", ro: "Avez-vous un menu en anglais?" },
          { ch: "çµå¸³", en: "Bill", jp: "L'addition, s'il vous plaÃ®t", ro: "L'addition, s'il vous plaÃ®t" }
        ],
        shopping: [
          { ch: "å¯ä»¥å…ç¨…å—ï¼Ÿ", en: "Tax-free?", jp: "C'est dÃ©taxÃ©?", ro: "C'est dÃ©taxÃ©?" },
          { ch: "å¤šå°‘éŒ¢ï¼Ÿ", en: "How much?", jp: "C'est combien?", ro: "C'est combien?" }
        ],
        hotel: [
          { ch: "æˆ‘è¦è¾¦ç†å…¥ä½", en: "Check-in", jp: "Le check-in, s'il vous plaÃ®t", ro: "Le check-in, s'il vous plaÃ®t" },
          { ch: "å¯ä»¥å¯„æ”¾è¡Œæå—ï¼Ÿ", en: "Luggage?", jp: "Puis-je laisser mes bagages?", ro: "Puis-je laisser mes bagages?" }
        ],
        sos: [
          { text: "æ•‘å‘½ï¼", jp: "Au secours!", ro: "Au secours!" },
          { text: "æˆ‘ä¸èˆ’æœ", jp: "Je ne me sens pas bien", ro: "Je ne me sens pas bien" },
          { text: "è­·ç…§ä¸è¦‹äº†", jp: "J'ai perdu mon passeport", ro: "J'ai perdu mon passeport" }
        ]
      }
    };

    // ==========================================
    // 3. å…ƒä»¶ (Components)
    // ==========================================
    const BigTextModal = ({ text, subText, onClose }) => (
      <div className="fixed inset-0 z-50 bg-black/95 flex flex-col items-center justify-center p-6 animate-in fade-in duration-200" onClick={onClose}>
        <button onClick={onClose} className="absolute top-6 right-6 text-white/50 hover:text-white"><X size={32} /></button>
        <div className="text-center space-y-8">
          <p className="text-white/60 text-xl font-medium">è«‹çµ¦åº—å“¡çœ‹é€™è¡Œå­—ï¼š</p>
          <h2 className="text-5xl md:text-7xl font-bold text-white leading-tight break-words">{text}</h2>
          <p className="text-yellow-400 text-2xl font-light mt-4">{subText}</p>
        </div>
        <div className="absolute bottom-10 text-white/30 text-sm">é»æ“Šä»»æ„è™•é—œé–‰</div>
      </div>
    );

    const NumberCard = ({ ch, en, jp, ro, tip, theme }) => {
      const [showBig, setShowBig] = useState(false);
      const playAudio = (e) => {
        e.stopPropagation();
        const utterance = new SpeechSynthesisUtterance(jp);
        utterance.lang = theme.langCode; utterance.rate = 0.9;
        window.speechSynthesis.speak(utterance);
      };
      return (
        <>
          <div className="bg-white/90 backdrop-blur-md rounded-2xl shadow-sm border-2 border-white p-4 flex flex-col items-center justify-center relative hover:shadow-md transition-shadow">
            <div className="text-center mb-2"><h3 className="text-4xl font-bold text-gray-800">{ch}</h3><p className={`text-sm ${theme.primaryColor} font-medium tracking-wide`}>{en}</p></div>
            <div className={`bg-white/50 rounded-lg px-6 py-2 mb-3 text-center w-full border border-gray-100`}>
              <p className="text-xl font-bold text-gray-900">{jp}</p>
              <p className="text-xs text-gray-500 font-mono">{ro}</p>
              {tip && <p className="text-[10px] text-gray-400 mt-1">ğŸ’¡ {tip}</p>}
            </div>
            <div className="flex gap-6 z-10">
              <button onClick={playAudio} className="p-3 rounded-full bg-gray-100 text-blue-600 hover:bg-blue-100 transition-colors shadow-sm"><Volume2 size={20} /></button>
              <button onClick={() => setShowBig(true)} className="p-3 rounded-full bg-gray-100 text-green-600 hover:bg-green-100 transition-colors shadow-sm"><Maximize2 size={20} /></button>
            </div>
          </div>
          {showBig && <BigTextModal text={jp} subText={ro} onClose={() => setShowBig(false)} />}
        </>
      );
    };

    const WordCard = ({ ch, en, jp, ro, tip, audioJp, theme }) => {
      const [flipped, setFlipped] = useState(false);
      const [showBig, setShowBig] = useState(false);
      const playAudio = (e) => {
        e.stopPropagation();
        const textToSpeak = audioJp || jp;
        const utterance = new SpeechSynthesisUtterance(textToSpeak);
        utterance.lang = theme.langCode; utterance.rate = 0.9;
        window.speechSynthesis.speak(utterance);
      };
      return (
        <>
          <div className={`relative h-40 w-full perspective-1000 cursor-pointer group`} onClick={() => setFlipped(!flipped)}>
            <div className={`relative w-full h-full duration-500 preserve-3d transition-transform ${flipped ? 'rotate-y-180' : ''}`}>
              <div className="absolute inset-0 backface-hidden bg-white/90 backdrop-blur-md rounded-2xl shadow-sm border-2 border-white flex flex-col items-center justify-center p-4 hover:shadow-md transition-shadow">
                <h3 className="text-2xl font-bold text-gray-800 text-center">{ch}</h3>
                <p className={`text-sm ${theme.primaryColor} mt-2 font-medium tracking-wide`}>{en}</p>
              </div>
              <div className={`absolute inset-0 backface-hidden rotate-y-180 bg-white/95 backdrop-blur-xl rounded-2xl shadow-lg border-2 border-gray-200 flex flex-col items-center justify-center p-4`}>
                <div className="text-center w-full">
                  <p className="text-xl font-bold text-gray-900 mb-1 truncate">{jp}</p>
                  <p className={`text-sm ${theme.primaryColor} font-medium`}>{ro}</p>
                  {tip && <p className="text-xs text-gray-400 mt-1">ğŸ’¡ {tip}</p>}
                </div>
                <div className="flex gap-4 mt-4 relative z-10">
                  <button onClick={playAudio} className="p-2 rounded-full bg-gray-100 text-blue-600 hover:bg-blue-100 transition-colors"><Volume2 size={18} /></button>
                  <button onClick={(e) => { e.stopPropagation(); setShowBig(true); }} className="p-2 rounded-full bg-gray-100 text-green-600 hover:bg-green-100 transition-colors"><Maximize2 size={18} /></button>
                </div>
              </div>
            </div>
          </div>
          {showBig && <BigTextModal text={jp} subText={ro} onClose={() => setShowBig(false)} />}
        </>
      );
    };

    const CharCell = ({ char, romaji, audio, theme, isKatakana }) => {
      if(!char || char === ' ') return <div className="aspect-square"></div>;
      
      const playKana = () => {
        const textToSpeak = audio || char;
        const u = new SpeechSynthesisUtterance(textToSpeak);
        u.lang = theme.langCode;
        window.speechSynthesis.speak(u);
      };
      
      return (
        <button onClick={playKana} className="aspect-square bg-white/60 hover:bg-white/90 active:scale-95 transition-all rounded-lg flex flex-col items-center justify-center border border-white/50 shadow-sm">
          <span className={`text-xl font-bold ${theme.primaryColor}`}>{char}</span>
          <span className="text-[10px] text-gray-500 font-mono mt-1">{romaji}</span>
        </button>
      );
    };

    // 1. ä¸»ç•«é¢é–‹å ´ (Main Splash) - Wishcore
    const MainSplash = ({ onStart }) => {
      return (
        <div className="fixed inset-0 z-50 flex flex-col items-center justify-between bg-[#FFFBF0] text-[#4A4A4A] animate-in fade-in duration-500 overflow-hidden py-16">
          <div className="z-10 text-center space-y-4 animate-in slide-in-from-top duration-700 mt-8">
            <h1 className="text-5xl font-black tracking-wider text-[#6A6A6A] drop-shadow-sm">å‡ºåœ‹æ”æ¬¸é€š</h1>
            <p className="text-xl text-[#9CA3AF] font-medium tracking-wide">ä¸€æ¬¾ç‚ºæ‚¨æ‰“é€ çš„å•å·´ App</p>
          </div>
          
          <div className="earth-wrapper z-0 my-auto">
            <div className="earth-container">
              <div className="orbit-container">
                <div className="airplane-icon">âœˆï¸</div>
              </div>
            </div>
          </div>

          <div className="z-10 w-full px-8 pb-12 animate-in slide-in-from-bottom duration-700">
            <button 
              onClick={onStart} 
              className="w-full bg-[#88D8C0] hover:bg-[#76C7AF] text-white text-xl font-bold py-4 rounded-3xl shadow-lg transition-all transform hover:scale-105 active:scale-95 flex items-center justify-center gap-2 border-2 border-white/50"
            >
              é–‹å•Ÿ App
            </button>
            <div className="text-center mt-6 text-[#C4C4C4] text-xs tracking-widest font-medium">TRAVEL SPEAK v1.0</div>
          </div>
        </div>
      );
    };

    // 2. èªè¨€é¸æ“‡å™¨
    const LanguageSelector = ({ onSelect, onBack }) => {
      return (
        <div className="fixed inset-0 z-40 flex flex-col items-center justify-center bg-[#FFFBF0] animate-in zoom-in duration-300">
          
          {/* æ–°å¢çš„è¿”å›é¦–é æŒ‰éˆ• */}
          <button 
            onClick={onBack}
            className="absolute top-6 left-6 text-gray-400 hover:text-gray-600 flex items-center gap-1 transition-colors"
          >
            <ChevronLeft size={24} />
            <span className="text-lg font-medium">è¿”å›é¦–é </span>
          </button>

          <h2 className="text-2xl font-bold text-gray-600 mb-8 tracking-wide">è«‹é¸æ“‡ä½ çš„èªè¨€</h2>
          <div className="grid grid-cols-2 gap-6 w-full max-w-sm px-6">
            <button onClick={() => onSelect('jp')} className="bg-[#FFF8E7] hover:bg-yellow-50 border-2 border-yellow-200 p-6 rounded-3xl flex flex-col items-center shadow-sm hover:shadow-md transition-all group">
              <span className="text-4xl mb-2 group-hover:scale-110 transition-transform">ğŸ‡¯ğŸ‡µ</span>
              <span className="font-bold text-gray-600">æ—¥æ–‡</span>
            </button>
            <button onClick={() => onSelect('kr')} className="bg-teal-50 hover:bg-teal-100 border-2 border-teal-200 p-6 rounded-3xl flex flex-col items-center shadow-sm hover:shadow-md transition-all group">
              <span className="text-4xl mb-2 group-hover:scale-110 transition-transform">ğŸ‡°ğŸ‡·</span>
              <span className="font-bold text-gray-600">éŸ“æ–‡</span>
            </button>
            <button onClick={() => onSelect('es')} className="bg-[#FAF3E0] hover:bg-orange-50 border-2 border-orange-200 p-6 rounded-3xl flex flex-col items-center shadow-sm hover:shadow-md transition-all group">
              <span className="text-4xl mb-2 group-hover:scale-110 transition-transform">ğŸ‡ªğŸ‡¸</span>
              <span className="font-bold text-gray-600">è¥¿æ–‡</span>
            </button>
            <button onClick={() => onSelect('fr')} className="bg-[#F5F5F5] hover:bg-blue-50 border-2 border-blue-200 p-6 rounded-3xl flex flex-col items-center shadow-sm hover:shadow-md transition-all group">
              <span className="text-4xl mb-2 group-hover:scale-110 transition-transform">ğŸ‡«ğŸ‡·</span>
              <span className="font-bold text-gray-600">æ³•æ–‡</span>
            </button>
          </div>
        </div>
      );
    }

    // 3. èªè¨€ä¸»ç¨‹å¼
    const LanguageApp = ({ langKey, onBack }) => {
      const theme = THEMES[langKey];
      const data = DB[langKey];
      const [activeTab, setActiveTab] = useState('foundation');
      const [bgItems, setBgItems] = useState([]);
      const [selectedScenario, setSelectedScenario] = useState(null);
      const [isKatakana, setIsKatakana] = useState(false); 

      useEffect(() => {
        const jpColors = ["text-pink-300", "text-blue-300", "text-yellow-300", "text-purple-300", "text-green-300", "text-red-300"];
        
        const items = Array.from({ length: 25 }).map((_, i) => ({
          id: i,
          top: Math.random() * 100,
          left: Math.random() * 100,
          size: Math.random() * 15 + 10,
          delay: Math.random() * 5,
          color: langKey === 'jp' ? jpColors[Math.floor(Math.random() * jpColors.length)] : '',
          
          // æ—¥æ–‡ (JP): 0=æ˜Ÿæ˜Ÿ(SVG), 1=åœ‹æ——, 2=æ«»èŠ±
          jpType: langKey === 'jp' ? Math.floor(Math.random() * 3) : 0,
          
          // éŸ“æ–‡ (KR): 0=å·§å…‹åŠ›, 1=åœ‹æ——
          krType: langKey === 'kr' ? Math.floor(Math.random() * 2) : 0,

          // è¥¿æ–‡ (ES): 0=ç‡‰é£¯, 1=åœ‹æ——
          esType: langKey === 'es' ? Math.floor(Math.random() * 2) : 0, 

          // æ³•æ–‡ (FR): 0=é•·æ£, 1=å¯é Œ, 2=åœ‹æ——
          frType: langKey === 'fr' ? Math.floor(Math.random() * 3) : 0 
        }));
        setBgItems(items);
      }, [langKey]);

      const renderContent = () => {
        switch (activeTab) {
          case 'foundation':
            return (
              <div className="space-y-6 animate-in slide-in-from-right duration-300">
                <div>
                  <h2 className={`text-lg font-bold ${theme.primaryColor} mb-3 flex items-center gap-2`}>
                    <Star className="fill-current" size={20} />
                    è¬ç”¨ç¥å¥ (Magic Words)
                  </h2>
                  <div className="grid grid-cols-2 gap-3">
                    {data.foundation.map((item, idx) => (
                      <WordCard key={idx} {...item} theme={theme} />
                    ))}
                  </div>
                  <p className="text-center text-gray-400 text-sm mt-8">æ•¸å­—ç‰¹è¨“è«‹å‰å¾€ã€Œæƒ…å¢ƒã€åˆ†é  ğŸšƒ</p>
                </div>
              </div>
            );
          case 'scenario':
            if (selectedScenario) {
              const categoryData = data[selectedScenario];
              const isNumberMode = selectedScenario === 'numbers';
              return (
                <div className="animate-in slide-in-from-right duration-300 h-full flex flex-col">
                  <button onClick={() => setSelectedScenario(null)} className={`mb-4 flex items-center text-gray-500 hover:${theme.primaryColor} transition-colors self-start`}>
                    <ChevronLeft size={20} /><span className="font-medium">è¿”å›åˆ†é¡</span>
                  </button>
                  <h2 className={`text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2`}>
                    {selectedScenario === 'numbers' ? <Calculator /> : <MapPin />}
                    {selectedScenario === 'numbers' ? 'æ•¸å­—ç‰¹è¨“' : 'æƒ…å¢ƒå°è©±'}
                  </h2>
                  {isNumberMode && <div className="mb-4 p-3 bg-gray-100 text-gray-600 text-sm rounded-lg">ğŸ’¡ æ•¸å­—å¡ç›´æ¥é¡¯ç¤ºç™¼éŸ³èˆ‡åŠŸèƒ½ï¼Œç„¡é ˆç¿»é¢ã€‚</div>}
                  <div className="space-y-3 pb-20 overflow-y-auto">
                    {categoryData.map((item, idx) => (
                      isNumberMode 
                        ? <NumberCard key={idx} {...item} theme={theme} />
                        : <WordCard key={idx} {...item} theme={theme} />
                    ))}
                  </div>
                </div>
              );
            }
            const SCENARIO_CATEGORIES = [
              { id: 'numbers', name: 'æ•¸å­—ç‰¹è¨“', icon: <Calculator size={24} /> },
              { id: 'transport', name: 'äº¤é€šç§»å‹•', icon: <Train size={24} /> },
              { id: 'dining', name: 'ç¾é£Ÿé¤å»³', icon: <Utensils size={24} /> },
              { id: 'shopping', name: 'è³¼ç‰©è¡€æ‹¼', icon: <ShoppingBag size={24} /> },
              { id: 'hotel', name: 'ä½å®¿é£¯åº—', icon: <Bed size={24} /> },
            ];
            return (
              <div className="grid grid-cols-2 gap-4 animate-in fade-in duration-300">
                {SCENARIO_CATEGORIES.map(cat => (
                  <button key={cat.id} onClick={() => setSelectedScenario(cat.id)} className={`flex flex-col items-center justify-center p-6 bg-white/80 backdrop-blur-md rounded-2xl shadow-sm hover:shadow-md transition-all border-2 border-transparent hover:border-gray-300 aspect-square ${theme.primaryColor}`}>
                    <div className={`p-4 rounded-full mb-3 bg-gray-100`}>{cat.icon}</div>
                    <span className="font-bold text-gray-700">{cat.name}</span>
                  </button>
                ))}
              </div>
            );
          case 'kana':
            return (
              <div className="space-y-4 animate-in zoom-in duration-300 pb-20">
                <div className={`flex items-center justify-center gap-3 mb-4`}>
                   <div className={`${theme.primaryColor} font-medium`}>{theme.tabLabel}è¡¨</div>
                   {langKey === 'jp' && (
                     <button onClick={() => setIsKatakana(!isKatakana)} className="bg-white border border-gray-200 px-3 py-1 rounded-full text-xs shadow-sm flex items-center gap-1 active:scale-95 transition-transform">
                       <Repeat size={12}/> {isKatakana ? 'åˆ‡æ›å¹³å‡å' : 'åˆ‡æ›ç‰‡å‡å'}
                     </button>
                   )}
                </div>
                <div className="bg-white/40 backdrop-blur-sm rounded-2xl p-4 border border-white/50">
                  {data.alphabet.map((row, idx) => (
                    <div key={idx}>
                      {row.title && <div className="text-xs text-gray-400 font-bold mt-3 mb-1 ml-1">{row.title}</div>}
                      <div className="grid grid-cols-5 gap-2 mb-2">
                        {row.items.map((item, itemIdx) => (
                          <CharCell 
                            key={`${idx}-${itemIdx}`} 
                            char={langKey === 'jp' ? (isKatakana ? item.k : item.h) : item.k} 
                            romaji={item.r} 
                            audio={item.a} 
                            theme={theme} 
                          />
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
                <p className="text-center text-gray-500 text-xs mt-2">é»æ“Šå­—æ¯å¯è½ç™¼éŸ³ ğŸ”ˆ</p>
              </div>
            );
          case 'sos':
            return (
              <div className="space-y-4 animate-in slide-in-from-bottom duration-300">
                <div className={`p-4 rounded-xl border border-red-100 text-center ${theme.sosColor} text-white shadow-lg`}>
                  <AlertTriangle className="mx-auto mb-2" size={32} />
                  <p className="font-bold">ç·Šæ€¥ç‹€æ³å°ˆç”¨</p>
                  <p className="text-xs opacity-80">é»æ“Šç›´æ¥å…¨è¢å¹•é¡¯ç¤º</p>
                </div>
                {data.sos.map((item, idx) => (
                  <button key={idx} className={`w-full p-4 bg-white border-2 border-red-100 text-red-600 rounded-xl shadow-sm hover:bg-red-50 transition-colors flex items-center justify-between group`} onClick={() => document.getElementById(`sos-btn-${idx}`).click()}>
                    <span className="font-bold text-lg">{item.text}</span>
                    <span className="text-sm opacity-80 font-mono">{item.ro}</span>
                    <Maximize2 size={20} className="opacity-50 group-hover:opacity-100" />
                    <div id={`sos-btn-${idx}`} className="hidden" onClick={(e) => { e.stopPropagation(); document.querySelector('[aria-label="Fullscreen"]').click() }}></div>
                    {item.text === "æ•‘å‘½ï¼" && <div style={{display:'none'}}><BigTextModal text={item.jp} subText={item.ro} onClose={()=>{}}/></div>}
                  </button>
                ))}
              </div>
            );
          default: return null;
        }
      };

      return (
        <div className="min-h-screen relative overflow-hidden font-sans transition-all duration-500" style={{ backgroundColor: theme.bgColor, ...theme.bgStyle }}>
          
          {/* èƒŒæ™¯å‹•ç•«ï¼šæ ¹æ“šèªè¨€é¡¯ç¤ºä¸åŒåœ–æ¡ˆ */}
          <div className="absolute inset-0 pointer-events-none z-0">
            {bgItems.map((item) => (
              <div
                key={item.id}
                className={`absolute ${langKey === 'jp' || langKey === 'es' || langKey === 'fr' ? `opacity-70 ${item.color}` : 'opacity-20 text-2xl'}`}
                style={{
                  top: `${item.top}%`,
                  left: `${item.left}%`,
                  fontSize: (langKey === 'jp') ? undefined : `${item.size}px`,
                  animation: `float 6s infinite ease-in-out ${item.delay}s`
                }}
              >
                {/* JP: å½©è‰²æ˜Ÿæ˜Ÿ / åœ‹æ—— / æ«»èŠ± */}
                {langKey === 'jp' && (
                  item.jpType === 0 ? <Star fill="currentColor" size={item.size} /> :
                  item.jpType === 1 ? "ğŸ‡¯ğŸ‡µ" : "ğŸŒ¸"
                )}
                
                {/* KR: å·§å…‹åŠ› / åœ‹æ—— */}
                {langKey === 'kr' && (
                  item.krType === 0 ? "ğŸ«" : "ğŸ‡°ğŸ‡·"
                )}

                {/* ES: ç‡‰é£¯ / åœ‹æ—— */}
                {langKey === 'es' && (
                  item.esType === 0 ? "ğŸ¥˜" : "ğŸ‡ªğŸ‡¸"
                )}

                {/* FR: é•·æ£ / å¯é Œ / åœ‹æ—— */}
                {langKey === 'fr' && (
                  item.frType === 0 ? "ğŸ¥–" : item.frType === 1 ? "ğŸ¥" : "ğŸ‡«ğŸ‡·"
                )}
              </div>
            ))}
          </div>

          <div className="relative z-10 w-full max-w-md mx-auto h-screen flex flex-col bg-white/40 shadow-2xl md:my-4 md:h-[95vh] md:rounded-[3rem] overflow-hidden border-2 border-white/50">
            <header className="pt-6 pb-2 px-6 bg-white/60 backdrop-blur-md z-20 sticky top-0 border-b border-white/50">
              <div className="flex justify-between items-end">
                <button onClick={onBack} className="flex items-center text-gray-400 hover:text-gray-600 text-xs mb-1">
                  <ChevronLeft size={14} /> é‡é¸èªè¨€
                </button>
              </div>
              <div className="flex justify-between items-end">
                <div>
                  <h1 className={`text-2xl font-black ${theme.primaryColor} tracking-wide flex items-center gap-2`}>
                    <span className={`${theme.accentColor} ${theme.buttonText} p-1 rounded-lg text-sm border border-white shadow-sm`}>{theme.code}</span>
                    {theme.name}
                  </h1>
                  <p className="text-xs text-gray-500 mt-1 font-medium">{theme.sub}</p>
                </div>
                <div className="text-2xl">
                  {activeTab==='foundation'?'ğŸ”°':activeTab==='scenario'?'ğŸšƒ':activeTab==='kana'? theme.code==='JP'?'ã‚': theme.code==='KR'?'ê°€': theme.code==='ES'?'Ã‘':'Ã‡' :'ğŸ†˜'}
                </div>
              </div>
            </header>

            <main className="flex-1 overflow-y-auto p-4 pb-24 scrollbar-hide">{renderContent()}</main>

            <nav className="absolute bottom-0 left-0 right-0 bg-white/80 backdrop-blur-lg border-t border-gray-100 p-2 pb-6 md:pb-2 z-30">
              <ul className="flex justify-around items-center">
                {[{ id: 'foundation', label: 'åŸºç¤', icon: <BookOpen size={20} /> }, { id: 'scenario', label: 'æƒ…å¢ƒ', icon: <MapPin size={20} /> }, { id: 'kana', label: theme.tabLabel, icon: <Languages size={20} /> }, { id: 'sos', label: 'æ•‘å‘½', icon: <AlertTriangle size={20} /> }].map(tab => (
                  <li key={tab.id}>
                    <button onClick={() => { setActiveTab(tab.id); setSelectedScenario(null); }} className={`flex flex-col items-center gap-1 p-2 rounded-xl transition-all duration-300 w-16 ${activeTab === tab.id ? `${theme.accentColor} ${theme.buttonText} shadow-lg -translate-y-2 scale-110` : `text-gray-400 hover:${theme.primaryColor}`}`}>
                      {tab.icon}<span className="text-[10px] font-bold">{tab.label}</span>
                    </button>
                  </li>
                ))}
              </ul>
            </nav>
          </div>
        </div>
      );
    }

    function App() {
      const [screen, setScreen] = useState('splash');
      const [selectedLang, setSelectedLang] = useState(null);
      const handleStart = () => setScreen('select');
      const handleSelectLang = (lang) => { setSelectedLang(lang); setScreen('app'); };
      const handleBack = () => { setSelectedLang(null); setScreen('select'); };
      const handleBackToSplash = () => { setScreen('splash'); };

      if (screen === 'splash') return <MainSplash onStart={handleStart} />;
      if (screen === 'select') return <LanguageSelector onSelect={handleSelectLang} onBack={handleBackToSplash} />;
      if (screen === 'app' && selectedLang) return <LanguageApp langKey={selectedLang} onBack={handleBack} />;
      return null;
    }

    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
